webpackJsonp([199],{1681:function(e,i){(function(){TS.registerModule("web.emoji",{onStart:function e(){TS.web.login_sig.add(TS.web.emoji.onLogin,TS.web.emoji);TS.web.emoji.bindUI()},onLogin:function e(){m();n()},bindUI:function i(){$("#addemoji input[name=mode]").change(function(){var e=$("#addemoji input[name=mode]:checked").val();$(".radio_selection").removeClass("active");$(this).closest(".radio_selection").addClass("active");if("alias"===e){a=true;$("#emojialias").prop("disabled",false)}else $("#emojialias").prop("disabled",true);if("data"===e){a=false;$("#emojiimg").prop("disabled",false)}else $("#emojiimg").prop("disabled",true);l()});$('[data-action="choose_emoji_alias"]').on("click",function(e){e.preventDefault();o(e)});if(TS.boot_data.feature_better_emoji_uploads){var n=document.querySelector("#emojiimg");n.files[0]&&c(n.files[0]);$("#emojiimg").change(function(){var e=n.files[0];e?c(e):s()});$("#addemoji_submit").on("click",function(e){var i=n.files[0];if(i){e.preventDefault();u(i)}});$("#emojiname").on("input",function(){l()})}$("#custom_emoji").on("click",'[data-action="emoji.remove"]',function(){var i="alias"===$(this).data("emoji-type");var a=$(this).data("emoji-name");var n=TS.interop.i18n.safeString(TS.emoji.graphicReplace(":"+a+":"));var o=$(this).closest(".emoji_row");o.addClass("highlight_red_bg");var t;var r;var m;var s;if(TS.boot_data.page_needs_enterprise)if(i){r=TS.interop.i18n.t("Remove this alias from {org_name}?","emoji")({org_name:TS.interop.i18n.safeString(_.escape(TS.model.team.enterprise_name))});t=TS.interop.i18n.t("<p>The alias <code>:{emoji_name}:</code> {emoji_img} will be removed from <b>all {org_name} workspaces</b>. This cannot be undone. The original emoji will be unaffected.</p>","emoji")({emoji_name:TS.interop.i18n.safeString(_.escape(a)),emoji_img:n,org_name:TS.interop.i18n.safeString(_.escape(TS.model.team.enterprise_name))});m=TS.interop.i18n.t("Remove Alias","emoji")()}else{r=TS.interop.i18n.t("Remove this emoji from {org_name}?","emoji")({org_name:TS.interop.i18n.safeString(_.escape(TS.model.team.enterprise_name))});t=TS.interop.i18n.t("<p>The emoji <code>:{emoji_name}:</code> {emoji_img} and its aliases will be removed from <b>all {org_name} workspaces.</b> This cannot be undone.</p>","emoji")({emoji_name:TS.interop.i18n.safeString(_.escape(a)),emoji_img:n,org_name:TS.interop.i18n.safeString(_.escape(TS.model.team.enterprise_name))});m=TS.interop.i18n.t("Remove Emoji","emoji")()}else if(i){r=TS.interop.i18n.t("Remove this alias?","emoji")();t=TS.interop.i18n.t("<p>Are you sure you want to remove this alias (:{emoji_name}: {emoji_img})?</p><p>This cannot be undone.</p>","emoji")({emoji_name:TS.interop.i18n.safeString(_.escape(a)),emoji_img:n});m=TS.interop.i18n.t("Remove Alias","emoji")()}else{r=TS.interop.i18n.t("Remove this emoji?","emoji")();t=TS.interop.i18n.t("<p>Are you sure you want to remove this emoji (:{emoji_name}: {emoji_img})?</p><p>Its aliases will also be deleted.</p><p>This cannot be undone.</p>","emoji")({emoji_name:TS.interop.i18n.safeString(_.escape(a)),emoji_img:n});m=TS.interop.i18n.t("Remove Emoji","emoji")()}e?l():TS.generic_dialog.start({title:r,body:t,show_cancel_button:true,cancel_button_text:s,show_go_button:true,go_button_text:m,go_button_class:"btn_danger",onGo:function i(){l();e=true},onCancel:function i(){e=false;o.removeClass("highlight_red_bg")}});function l(){o.fadeOut(500);return new Promise(function(e,i){TS.interop.api.callExpedited("emoji.remove",{name:a}).then(function(){e()},function(e){TS.generic_dialog.alert(TS.interop.i18n.t("Hmmm ... that didn\u2019t work for some reason. Please wait a moment and try again.","emoji")());TS.info("Problem in emoji.remove request."+e);o.removeClass("highlight_red_bg").fadeIn(150);i(e)})})}});$("#custom_emoji").on("click",".rename_emoji",function(){var e=$(this).data("emoji-name");var i=$(this).data("emoji-img-url");var a='<span class="emoji-outer emoji-sizer emoji-bg-contain" style="background-image: url(\''+i+"'); background-color: transparent;\"></span>";var n=$(this).closest("form");var o=n.find("[name=new_name]");var t=TS.interop.i18n.t('<p class="align_center"><label>Enter a new name for {emoji_img} <span class="normal">(was :{emoji_name}:)</span></label><input type="text" class="input_inline no_bottom_margin" id="emoji_rename_input" value="{new_emoji_name}" placeholder="name"></p>',"emoji")({emoji_name:TS.interop.i18n.safeString(_.escape(e)),emoji_img:TS.interop.i18n.safeString(a),new_emoji_name:TS.interop.i18n.safeString(_.escape(o.val()))});TS.generic_dialog.start({title:TS.interop.i18n.t("Rename your emoji","emoji")(),body:t,show_cancel_button:true,show_go_button:true,go_button_text:TS.interop.i18n.t("Rename","emoji")(),enter_always_gos:true,onGo:function e(){var i=$("#emoji_rename_input").val().replace(/:/g,"");if(!i)return false;if(i.match(/[^a-z0-9-_]/)){alert(TS.interop.i18n.t("{new_name} contains illegal characters. Custom emoji names can only contain lower case letters, numbers, dashes and underscores.","emoji")({new_name:i}));return false}if(":"+i+":"!=TS.emoji.replaceColons(":"+i+":")){alert(TS.interop.i18n.t("{new_name} is already in use!","emoji")({new_name:i}));return false}o.val(i);n.submit()}})});$("#custom_emoji .lazy").one("lazyloaded",function(){$(this).css("background-color","transparent")}).lazyload()}});var e=false;var i=false;var a=false;var n=function e(){TS.prefs.mergeEmojiUse(TS.prefs.getPref("emoji_use"));TS.emoji.maybeRemakeMenuListsIfFrequentsChanged()};var o=function e(i){TS.ui.react_emoji_menu.start({e:i,callback:t})};var t=function e(i){if(i){$("#set_emoji_alias").addClass("hidden");$("#emoji_alias_container").removeClass("hidden");$("#addemoji input[name=mode][value=alias]").prop("checked",true);i=TS.emoji.maybeGetCanonicalEmojiString(i);$('input[name="alias"]').val(r(i));$("#emoji_alias_preview").html(TS.emoji.graphicReplace(i));$("#emojiimg").prop("disabled",true);a=true;l()}};var r=function e(i){i=i.replace(/(:skin-tone-[2-6]:)/,"");i=i.replace(/:/g,"");return i};var m=function e(){var i=$("#emoji_inline_preview").data("name");if(!i)return;TS.emoji.isEmojiNameSafe(i)?$("#emoji_inline_preview").html(TS.emoji.graphicReplace(":"+i+":")):TS.error("Can't display emoji inline preview because data is invalid: "+i)};var s=function e(){var i=document.querySelector("#emoji_upload_preview");var a=i.getContext("2d");a.clearRect(0,0,64,64)};var l=function e(){if(!TS.boot_data.feature_better_emoji_uploads)return;var n=document.querySelector("#emojiname").value.trim().length>0;var o=!n||!a&&!i;$("#addemoji_submit").attr("disabled",o).attr("aria-disabled",o)};var c=function e(a){var n=new Image;n.src=window.URL.createObjectURL(a);var o=document.querySelector("#emoji_upload_preview");var t=o.getContext("2d");t.clearRect(0,0,64,64);n.onload=function(){var e=n.naturalWidth;var a=n.naturalHeight;var o=d(e,a,64);t.imageSmoothingQuality="high";t.imageSmoothingEnabled=true;t.drawImage(n,o.x,o.y,o.width,o.height);i=true;l()};n.onerror=function(){i=false;l()}};var d=function e(i,a,n){var o=i/a;var t=n;var r=n;var m=0;var s=0;if(i>a){r=n/o;s=(n-r)/2}else if(a>i){t=n*o;m=(n-t)/2}return{x:m,y:s,width:t,height:r}};var u=function e(i){var a=document.querySelector("#emoji_resized");var n=new Image;n.src=window.URL.createObjectURL(i);n.onload=function(){var e=n.naturalWidth;var i=n.naturalHeight;window.URL.revokeObjectURL(n.src);var o=boot_data.emoji_max_size;if(e>o||i>o||e!==i){o=Math.min(e,i,o);var t=d(e,i,o);var r=document.createElement("canvas");r.width=o;r.height=o;var m=r.getContext("2d");m.imageSmoothingQuality="high";m.imageSmoothingEnabled=true;m.drawImage(n,t.x,t.y,t.width,t.height);var s=r.toDataURL("image/png");a.value=s;document.getElementById("addemoji").submit()}else{a.value=null;document.getElementById("addemoji").submit()}}}})()}},[1681]);